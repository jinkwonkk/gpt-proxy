type PromptInput = {
  userName: string
  gender: string
  birth: { year: number; month: number; day: number; hour?: number }
  saju: any
  question?: string
  selectedItems: string[]
}

const promptMap: Record<string, string> = {
  '직업운': `📌 직업운 보고서 (2025년 기준)
1. 현재 사주에서 드러나는 직업적 성향과 강점
2. 어울리는 직업 유형 및 진로 방향
3. 진로 변경 가능성 및 최적 시기
4. 직장 내 인간관계 주의사항
5. 향후 1~3년 직업운 흐름 및 핵심 조언`,

  '재물운 / 금전운': `📌 재물운 보고서 (2025년 기준)
1. 사주상의 금전 운세 흐름
2. 재물복 유무 및 재정 변화 시기
3. 지출 관리 요령 및 재테크 전략
4. 투자, 부수입, 사업 가능성 등`,

  '연애운 / 사랑운': `📌 연애운 보고서 (2025년 기준)
1. 현재 연애 기운 및 감정 흐름
2. 새로운 인연 가능 시기 및 유형
3. 연애 성향 및 스타일
4. 궁합 유형 및 갈등 대처법
5. 올해 최적 연애 타이밍과 조언`,

  '건강운': `📌 건강운 보고서 (2025년 기준)
1. 사주에서 드러나는 건강 체질 및 취약 부위
2. 만성질환 또는 반복되는 질병의 가능성
3. 특정 시기에 건강상 주의해야 할 부분
4. 정신 건강 및 스트레스 관리 성향
5. 식습관과 운동 습관에 대한 사주적 조언
6. 건강운이 좋아지는 시기 또는 회복 운
7. 병원 진료나 수술 등 필요한 결정 시기
8. 건강 유지 및 증진을 위한 실질적인 행동 지침`,

 '결혼운': `📌 결혼운 보고서 (2025년 기준)
1. 사주에서 나타나는 결혼 성향과 결혼에 대한 태도
2. 결혼 적령기 및 실제 결혼 가능 시기
3. 결혼 생활에서의 강점과 약점
4. 배우자와의 관계에서 주의할 점
5. 사주상 만날 가능성이 높은 배우자 유형 (성격, 직업 등)
6. 결혼 후 운세 흐름의 변화
7. 결혼 전 반드시 고려해야 할 핵심 조언
8. 재혼 가능성이나 늦은 결혼의 유불리 여부`,

    '인간관계 / 대인운': `📌 대인관계 보고서 (2025년 기준)
1. 사주상 인간관계 성향(외향/내향, 적극/소극 등)
2. 좋은 인간관계를 맺는 유형과 거리 두어야 할 유형
3. 친구 및 동료와의 상호작용 패턴
4. 갈등이 생기기 쉬운 상황과 대처법
5. 사주에 따른 인기운 또는 대인운 시기
6. 인간관계를 통한 기회 유입 가능성
7. 사람을 보는 통찰력 및 사람 복에 대한 분석
8. 좋은 인연을 끌어당기기 위한 실천 조언`,

    '전생 / 인연운': `📌 전생·인연 보고서 (2025년 기준)
1. 사주에서 유추할 수 있는 전생 기질과 성격
2. 전생에서 이어져온 인연의 가능성
3. 이번 생에서 반복될 수 있는 전생 과업
4. 카르마적 관계에서 주의할 점
5. 운명적인 만남 혹은 숙명적 인연 존재 여부
6. 인연을 마주할 시기의 징조
7. 전생에서 미처 완성하지 못한 과제
8. 이번 생에서 완성할 수 있는 길`,

    '학업운 / 시험운': `📌 학업·시험운 보고서 (2025년 기준)
1. 사주상 지적 능력과 집중력의 특성
2. 성취 가능성이 높은 학문 분야
3. 시험운의 흐름과 유리한 시기
4. 장기 계획 VS 단기 성과 중 어느 쪽에 강한가?
5. 공부 습관에서 개선하면 좋은 점
6. 올해 또는 특정 시기의 집중력/성적 운 상승 시기
7. 경쟁 시험(공무원, 수능, 자격증 등)에서 주의할 점
8. 학업에 영향을 줄 수 있는 외부 요인 (가족, 건강 등)`,

    '시기운 / 대운 흐름': `📌 시기운·대운 분석 (2025년 기준)
1. 현재 대운(10년 단위)의 주요 특징과 영향력
2. 대운의 흐름에 따라 인생 전반의 기운 변화 요약
3. 좋은 대운/주의할 대운 시기 구간별 정리
4. 각 대운 시기에 두드러지는 운세 분야(연애, 직업, 건강 등)
5. 대운 변경 시점 전후로 주의할 사항
6. 대운의 흐름과 본인의 사주 성향의 조화 여부
7. 대운 외에도 중요한 세운(1년 단위) 변화 시기
8. 장기 인생 계획에 참고할 운세 흐름 요약`,

    '미래 핵심 조언': `📌 미래 핵심 조언 (2025년 기준)
1. 사주 전체 분석을 통한 삶의 방향성 제안
2. 현재 가장 집중해야 할 영역
3. 놓치면 안 되는 기회 시기
4. 인생 전반에서 마주할 중요한 과제
5. 조화로운 삶을 위한 사주적 태도
6. 나를 성장시키는 방식과 학습 스타일
7. 인간관계에서 꼭 지켜야 할 원칙
8. 미래를 위한 실천적 조언 요약`,
 
    '이사 / 이동운': `📌 이사/이동운 보고서 (2025년 기준)
1. 사주상 이사 또는 거주지 변경의 가능성과 빈도
2. 언제 이사하거나 이동하는 것이 운 흐름상 유리한지
3. 이사 시 주의할 방향 또는 지역의 특징
4. 이사 이후 삶에 미치는 긍정적/부정적 영향
5. 현재 거주지의 기운이 사주에 미치는 영향
6. 해외 또는 먼 지역으로의 이동 가능성
7. 직장, 가족, 건강 등 이동 사유와의 연관성
8. 이사 시 고려해야 할 타이밍과 실질적 조언`,

    '귀인운': `📌 귀인운 보고서 (2025년 기준)
1. 사주에 드러난 귀인(도움 주는 사람)의 존재 유무
2. 귀인이 등장하는 시기 및 상황
3. 귀인의 성격/특징 및 예상 관계 유형
4. 귀인과 인연을 맺는 방법과 자세
5. 귀인이 주는 도움의 종류(정신적, 물질적 등)
6. 귀인 운이 강해지는 시기
7. 귀인을 놓치지 않는 핵심 조언
8. 귀인과의 관계 지속을 위한 자세`,

    '사업운': `📌 사업운 보고서 (2025년 기준)
1. 사주상 사업 적성 여부와 추천 유형
2. 창업 성공 가능성 및 타이밍
3. 파트너와의 사업 궁합 분석
4. 사주에서 나타나는 리스크 요인
5. 사업 확장 또는 축소 시점
6. 안정적 수익구조를 만들 수 있는 운 흐름
7. 사업 실패를 방지할 조언
8. 적합한 사업 분야 및 성공 조건`,

    '종합운': `📌 종합운 보고서 (2025년 기준)
1. 전체적인 운세 흐름과 기조
2. 강한 운과 약한 운의 분야(예: 연애, 금전, 건강 등)
3. 향후 1~3년간 운의 전반적 흐름
4. 전체적인 사주의 균형 상태 (오행, 음양 등)
5. 인생 전반에서 주의할 시기와 기회 시기
6. 운명적 전환점과 주요 이슈 시기
7. 전체 사주의 장단점 요약
8. 사주 전반에 대한 조화로운 삶을 위한 조언`,

    '이직운': `📌 이직운 보고서 (2025년 기준)
1. 사주상 이직 운세 흐름과 경향성
2. 현재 직장에 대한 궁합 및 만족도 예측
3. 이직 성공 가능성이 높은 시기
4. 사주상 안정 추구형 vs 변화 추구형 여부
5. 이직 시 고려해야 할 핵심 조언
6. 이직 후 운세 흐름 및 기대 효과
7. 자신에게 맞는 직무/환경 유형
8. 이직에 실패할 수 있는 시기나 조건`,

    '가족운': `📌 가족운 보고서 (2025년 기준)
1. 사주에서 드러나는 가족과의 유대감 성향
2. 부모와의 관계 운세 및 영향력
3. 형제자매와의 관계 흐름
4. 결혼 후 새로운 가족과의 관계
5. 가족으로 인한 정신적/금전적 부담 여부
6. 가족 내에서 갈등이 발생하기 쉬운 원인
7. 사주상 가족 간 화합을 위한 조언
8. 향후 가족운의 변화 흐름 및 유의점`,
  // ... (다른 항목들도 같은 형식으로 추가)
}

export function getSajuPrompt({
  userName,
  gender,
  birth,
  saju,
  question,
  selectedItems
}: PromptInput): string {
  const baseInfo = `
이름: ${userName}
성별: ${gender}
생년월일: ${birth.year}-${birth.month}-${birth.day} ${birth.hour ?? 0}시
사주 명식: ${JSON.stringify(saju)}
  `

  const aliasMap: Record<string, string> = {
    '연애운': '연애운 / 사랑운',
    '사랑운': '연애운 / 사랑운',
    '금전운': '재물운 / 금전운',
    '재물운': '재물운 / 금전운',
    '대인운': '인간관계 / 대인운',
    '인연운': '전생 / 인연운',
    '시험운': '학업운 / 시험운',
    '학업운': '학업운 / 시험운',
    '귀인': '귀인운',
    '종합': '종합운',
    '이사운': '이사 / 이동운',
    '이동운': '이사 / 이동운',
    '대운 흐름': '시기운 / 대운 흐름',
  }

  const resolvedItems = selectedItems.map(item => aliasMap[item] || item)

  const selectedPrompts = resolvedItems
    .filter(item => !!promptMap[item])
    .map(item => promptMap[item])
    .join('\n\n')

  const baseOnlyPrompt = `
📅 참고: 현재는 2025년 기준입니다.

🔮 아래는 사용자의 사주 정보입니다.

${baseInfo}

---

📌 기본 사주 리포트 (전문가 작성)

당신은 대한민국 최고의 사주 분석 전문가입니다. 아래 사주 명식을 바탕으로 고객의 전체적인 사주팔자를 다음 항목에 따라 논리적으로 분석한 리포트를 작성해주세요. 문단마다 제목을 붙이고, 각 해석은 실제 상담 리포트처럼 자세하고 이해하기 쉽게 구성하세요. 돈을 지불한 고객이 충분히 만족할 수 있어야 합니다.

❗ 반드시 포함해야 할 항목:
1. 전체적인 인생 기운의 흐름 요약
2. 성격 및 기본 성향 분석 (일간 중심)
3. 오행 분포 해석 및 강/약한 요소
4. 인생의 주요 전환점 시기
5. 사주의 강점과 약점
6. 주의할 시기 또는 반복되는 패턴
7. 고객에게 꼭 필요한 조언

❗ '정보 부족', '알 수 없음' 같은 말은 절대 하지 마세요. 사주 명식을 최대한 활용해 유의미한 해석을 해주세요.
`

  const finalPrompt =
    selectedItems.length === 0
      ? baseOnlyPrompt
      : `
📅 참고: 현재는 2025년 기준입니다.

🔮 아래는 사용자의 사주 정보입니다.

${baseInfo}

---

🧞 사용자가 선택한 해석 항목에 대해 각 항목별로 아래와 같이 보고서 혹은 리포트 형식으로 정리해 주세요:

${selectedPrompts}
`

  return finalPrompt.trim()
}
